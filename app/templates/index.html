{% extends '_base.html' %}

{% block content %}
<style>
    .table_row {
        cursor: pointer;
    }
    .table_row:hover {
        background-color: rgb(193, 193, 255);
    }

</style>


<div id="app">
    <div class="columns">
        <div class="column is-5">
            <a href="{{ url_for('new_file') }}"
            class="button is-primary is-small is-light is-outlined m-2">+New document</a>
            <hr>
            <div  style="overflow-y:scroll; word-wrap:break-word; height:700px;">
                <table class="table is-narrow">
                    <tr @mouseover="preview(doc.id);" class="table_row"
                    v-for="doc in docs">
                        <td >[[ doc.title ]]</td>
                        <td><label class="button is-small is-warning"
                            @click="checked(doc.id)">Delete</label>
                        <a :href="'delete/' + [[ doc.id ]]" class="button is-danger is-small"
                         :id="'confirm_'+doc.id" style="visibility: hidden;">confirm</a></td>
                        <td><a :href="" class="button is-small">Print</a></td>
                        <td><a :href="'edit/'+[[ doc.id ]]"
                            class="button is-primary is-small is-light is-outlined">Edit</a></td>
                    </tr>
                </table>

            </div>
        </div>
        <div class="column is-7">
            <div id="render" onscroll="syncScroll(this)" class="ml-2 mt-3 pb-4 column"
                style="overflow-y:scroll; word-wrap:break-word; height:700px;">
            </div>
        </div>
    </div>


{% endblock content %}

{% block script %}
<script>
    const docs = {{ docs | safe }}
    const { createApp } = Vue

    createApp({
        delimiters: ['[[', ']]'],
        data() {
            return {
                docs: docs,
                preview_html: "",
            }
        },
        methods:{
            checked(id) {
                if (this.checked) {
                    console.log(id)
                    del_button = document.getElementById('confirm_'+id)
                    if (del_button.style.visibility == 'hidden'){
                        del_button.style.visibility = "visible"
                    } else {
                        del_button.style.visibility = "hidden"
                    }
                    console.log(del_button.style.visibility)
                }
            },
            get_doc_by_id(id){
                let doc = this.docs.filter( item => item.id == id)[0]
                console.log(doc.title)
                return marked.parse(doc.content)+"<br>"
            },
            preview(id) {
                console.log("preview...", id)
                var render = document.getElementById("render")
                render.innerHTML = this.get_doc_by_id(id)

                var links = render.getElementsByTagName('a')
                for (var i=0; i<links.length; i++){
                    var link = links[i]
                    links[i].addEventListener('click', event => {
                        event.preventDefault();
                    })
                }
            },
        },

    }).mount('#app')


</script>

{% endblock script %}